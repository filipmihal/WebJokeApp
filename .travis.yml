env:
  global:
    - CC_TEST_REPORTER_ID=e46474ef2b749ea6f089d20d8a00fd0b2002d65f8c46ee48f5a1b667e8e5c319
    - GIT_COMMITTED_AT=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then git log -1 --pretty=format:%ct; else git log -1 --skip 1 --pretty=format:%ct; fi)
language: python
python:
- 3.6.1
cache: pip
install: pip install -r requirements.txt
before_script:
  - nohup waitress-serve --listen=127.0.0.1:5000 app:APP &
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
script:
  - python flask_tests.py
  - python ui_test.py
  - bundle exec rspec
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
deploy:
  provider: heroku
  api_key:
    secure: wE+x3u22zmxfZxds7/7Z9OOmWtIU5rd/PCRYjcE7eP0W+ZiPxquroCndv8dr/fRFBzUQfX8qNmp/DPdMiIbm4z4jvGqxwCCWz3LcG7CXQeITuZUk0h9TzuMKATBfYInj9qttGSA6tq8vUf8HdtPWpyCocmdtpIT2B2AH5tnL4MLun8VFjP1EgYOf7hFCzp+97IBNkLhuol3x6QR+GeJFDS+u8PuJAwiRFZXeElS1Xk0RuQ93uOoHRvkP2MgIgq9fvqTJmQ8sioAxGT6Rh4MffS4ak15qdayrs92xQrP2B0KVkHXfh0WjOC3c2zuZ2qv0Bu3xkgia3oThS9ORksBNCh8txh2LVKR7Dv/HK7ZrVO8x6EBxzg3Ou8fbeZuZZx87awSaNyPoEYpIFQcy2VR8CK3Thr/DxpSzACxn5heL2IrUTnpHfrKAOJ1KqBzHl61EdjlLJZQhmLGeBgRPI/DuE/8iAvRse5DyRaIUPyoQuCCbYv9CJkemLapdcOg6Qgj6P6QxY9nA8L7xQaQZAItOBaJqDeQDUQbiGh2O2FuBFS/HJ7h6d5GOpOrpCx5W3XBDdxFf/tVeV9JYx/Ms1Z/QUGAgIm/IzBxPNTcHazdc5xkffEB0f91uE1sv3TP6+wFIMNDymikZrYs4jEXZYWnuDoyKaYzxBt2NGBZkfMKmoaU=
  app: vtipystarejmatere
  on:
    repo: filipmihal/WebJokeApp
